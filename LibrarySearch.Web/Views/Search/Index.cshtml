@model List<LibrarySearch.Web.Models.BookResultViewModel>

@{
    ViewData["Title"] = "Book Search Engine";
}

<div class="container mt-4">
    <h2 class="mb-4">Book Finder with Gemini</h2>

    <form asp-controller="Search" asp-action="Index" method="post" class="mb-5">
        <div class="form-group">
            <label for="query" class="form-label">Enter your search (Title, author, or fragments):</label>
            <input type="text" name="query" class="form-control form-control-lg" placeholder="Ej: Tolkien Hobbit Illustrated 1937" required />
            <button type="submit" class="btn btn-primary btn-lg mt-3 w-100">Search Book</button>
        </div>
    </form>

    <hr />

    @if (Model != null && Model.Any())
    {
        <div class="results">
            <h4 class="mb-3">Results found:</h4>
            @foreach (var book in Model)
            {
                <div class="card mb-3 shadow-sm">
                    <div class="row g-0">
                        <div class="col-md-2 d-flex align-items-center justify-content-center bg-light">
                            @if (!string.IsNullOrEmpty(book.CoverUrl))
                            {
                                <img src="@book.CoverUrl" class="img-fluid rounded-start p-2" alt="Portada de @book.Title" style="max-height: 150px;">
                            }
                            else
                            {
                                <div class="text-muted small">No Cover</div>
                            }
                        </div>

                        <div class="col-md-10">
                            <div class="card-body">
                                <h5 class="card-title text-primary">@book.Title</h5>
                                <h6 class="card-subtitle mb-2 text-muted">
                                    <strong>Author:</strong> @book.Author |
                                    <strong>Year:</strong> @(book.FirstPublishYear?.ToString() ?? "N/A")
                                </h6>

                                <div class="alert alert-secondary py-2 mt-2 mb-0">
                                    <small><strong>explanation:</strong> @book.Explanation</small>
                                </div>

                                @if (!string.IsNullOrEmpty(book.OpenLibraryId))
                                {
                                    <div class="mt-2 text-end">
                                        <small class="text-muted">ID: @book.OpenLibraryId</small>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else if (Model != null)
    {
        <script>
            console.log("Datos recibidos en el Front-end:");
            console.table(@Json.Serialize(Model));
        </script>
        <div class="alert alert-warning mt-4">
            No books were found matching your search. Please try other terms.
        </div>
    }
</div>